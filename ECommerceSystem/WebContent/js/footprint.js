function log(m,j,p,o,n,k,h,g,f,e,d,c){var l="";for(i=2;i<arguments.length;i++){l=l+arguments[i]+"|||"}var a=decodeURIComponent(escape(getCookie("pin")));var q="http://csc."+pageConfig.FN_getDomain()+"/log.ashx?type1=$type1$&type2=$type2$&data=$data$&pin=$pin$&referrer=$referrer$&jinfo=$jinfo$&callback=?";var b=q.replace(/\$type1\$/,escape(m));b=b.replace(/\$type2\$/,escape(j));b=b.replace(/\$data\$/,escape(l));b=b.replace(/\$pin\$/,escape(a));b=b.replace(/\$referrer\$/,escape(document.referrer));b=b.replace(/\$jinfo\$/,escape(""));$.getJSON(b,function(){})}function clsPVAndShowLog(d,c,a,e){var b=d+"."+a+"."+skutype(c)+"."+e;log("d","o",b)}function clsClickLog(f,d,g,b,a,e){var c=f+"."+b+"."+skutype(d);appendCookie(e,g,c);log("d","o",c+".c")}function appendCookie(reCookieName,sku,key){var reWidsCookies=eval("("+getCookie(reCookieName)+")");if(reWidsCookies==null||reWidsCookies==""){reWidsCookies=new Object()}if(reWidsCookies[key]==null){reWidsCookies[key]=""}var pos=reWidsCookies[key].indexOf(sku);if(pos<0){reWidsCookies[key]=reWidsCookies[key]+","+sku}setCookie(reCookieName,$.toJSON(reWidsCookies),15)}function skutype(b){if(b){var a=b.toString().length;return a==10?1:0}return 0}function setCookie(b,d,a){var c=a;var e=new Date();e.setTime(e.getTime()+c*24*60*60*1000);document.cookie=b+"="+escape(d)+";expires="+e.toGMTString()+";path=/;domain=."+pageConfig.FN_getDomain()+""}function getCookie(b){var a=document.cookie.match(new RegExp("(^| )"+b+"=([^;]*)(;|$)"));if(a!=null){return unescape(a[2])}return null}function clsLog(b,a,e,c,d){appendCookie(d,e,b);e=e.split("#")[0];log(3,b,e)}(function(a){a.fn.imgScroll=function(b,e){var d={evtType:"click",visible:1,direction:"x",next:"#next",prev:"#prev",disableClass:"disabled",disableClassPerfix:false,speed:300,step:1,loop:false,showControl:false,width:null,height:null,navItems:false,navItmesWrapClass:"scroll-nav-wrap",navItemActivedClass:"current",status:false,statusWrapSelector:".scroll-status-wrap"};var c=a.extend(d,b);return this.each(function(){var u=a(this),y=u.find("ul").eq(0),B,f=y.children("li"),I=f.length,p=null,l=null,k=typeof c.next=="string"?a(c.next):c.next,h=typeof c.prev=="string"?a(c.prev):c.prev,C=0,r=c.step,j=c.visible,O=Math.ceil((I-j)/r)+1,M=c.loop,A=c.direction,z=c.evtType,o=c.disableClass,L=c.disableClassPerfix?"prev-"+o:o,N=c.disableClassPerfix?"next-"+o:o,t=c.navItems,E=c.navItmesWrapClass,K=a("."+E).length>0,x=c.navItemActivedClass,D=c.status,H=c.statusWrapSelector,J=a(H).length>0,v=false,s=true,G=(I-j)%r===0;function F(P){if(I>=r+j&&!M){h.addClass(L);k.removeClass(N)}else{if(!M){k.addClass(N)}}if(f.eq(0).css("float")!=="left"){f.css("float","left")}p=c.width||f.eq(0).outerWidth();l=c.height||f.eq(0).outerHeight();u.css({position:u.css("position")=="static"?"relative":u.css("position"),width:P=="x"?p*j:p,height:P=="x"?l:l*j,overflow:"hidden"});y.css({position:"absolute",width:P=="x"?p*I:p,height:P=="x"?l:l*I,top:0,left:0});if(typeof e==="function"){e.apply(u,[C,O,f.slice(C*r,C*r+j),f.slice(C*r+j-r,C*r+j)])}}function n(Q,R){if(y.is(":animated")){return false}if(M){if(s&&R){C=O}if(v&&!R){C=-1}Q=R?--C:++C}else{if(s&&R||v&&!R){return false}else{Q=R?--C:++C}}B=A=="x"?{left:Q>=(O-1)?-(I-j)*p:-Q*r*p}:{top:Q>=(O-1)?-(I-j)*l:-Q*r*l};function P(){if(!M){if(I-Q*r<=j){k.addClass(N);v=true}else{k.removeClass(N);v=false}if(Q<=0){h.addClass(L);s=true}else{h.removeClass(L);s=false}}else{if(I-Q*r<=j){v=true}else{v=false}if(Q<=0){s=true}else{s=false}}if(t||D){q(Q)}if(typeof e=="function"){e.apply(u,[Q,O,f.slice(Q*r,Q*r+j),f.slice(Q*r+j-r,Q*r+j)])}}if(!!c.speed){y.animate(B,c.speed,P)}else{y.css(B);P()}}function g(S,P){var Q=K?a("."+S).eq(0):a('<div class="'+S+'"></div>');for(var R=0;R<O;R++){Q.append("<em "+(R===0?" class="+P:"")+' title="'+(R+1)+'">'+(R+1)+"</em>")}if(!K){u.after(Q)}}function w(){var P=J?a(H).eq(0):a('<div class="'+H.replace(".","")+'"></div>');P.html("<b>1</b>/"+O);if(!J){u.after(P)}}function q(P){if(t){a("."+E).find("em").removeClass(x).eq(P).addClass(x)}if(D){a(H).html("<b>"+(P+1)+"</b>/"+O)}}function m(){h.unbind(z).bind(z,function(){n(C,true)});k.unbind(z).bind(z,function(){n(C,false)})}if(I>j&&j>=r){F(A);m();if(t){g(E,x)}if(D){w(H)}}else{if(c.showControl){k.add(h).show()}else{k.add(h).hide()}h.addClass(L);k.addClass(N)}})}})(jQuery);var ProductTrack=function(c,a,b){this.sRecent=c;this.sGuess=a;this.isBook=b||false;$(this.sGuess).find("h2").html("\u6839\u636e\u6d4f\u89c8\u4e3a\u6211\u63a8\u8350")};ProductTrack.prototype={hide:function(){$(this.sRecent).hide();$(this.sGuess).hide()},getCommentData:function(a){var b=this;$.ajax({url:"http://club.360buy.com/clubservice.aspx?method=GetCommentsCount&referenceIds="+a,dataType:"jsonp",success:function(c){b.setCommentData(c)}})},setCommentData:function(c){var a=c.CommentsCount.length;for(var b=0;b<a;b++){$("#g"+c.CommentsCount[b].SkuId).find(".star").removeClass("sa5").addClass("sa"+c.CommentsCount[b].AverageScore);$("#g"+c.CommentsCount[b].SkuId).find(".p-comm a").html("(\u5df2\u6709"+c.CommentsCount[b].CommentCount+"\u4eba\u8bc4\u4ef7)")}},getData:function(a){var a=a||"http://my."+pageConfig.FN_getDomain()+"/global/track.action?jsoncallback=?";_this=this;$.ajax({url:a,dataType:"json",success:function(b){_this.setContent(b)},error:function(){_this.hide()}});return this},setContent:function(g,d,b){var l=" onclick=\"clsClickLog('', '', '${list.wid}', 3, ${list_index}, 'rodGlobalHis');\"";var a=" onclick=\"clsClickLog('', '', '${list.wid}', 2, ${list_index}, 'rodGlobalTrack');\"";if(this.isBook){l=" onclick=\"clsLog('${list.wpid}&HomeHis', '', '${list.wid}#${list.wmeprice}', ${list_index}, 'reWidsBookHis');\"";a=" onclick=\"clsLog('${list.wpid}&HomeTrack', '', '${list.wid}#${list.wmeprice}', ${list_index}, 'reWidsBookTrack');\""}if($("#product-track").length>0){$("#product-track").html('<div class="right"> <div id="maybe-like" class="m m2" data-widget="tabs"> <div class="mt"> <h2>\u6839\u636e\u6d4f\u89c8\u731c\u4f60\u559c\u6b22</h2> <div class="extra"> </div> </div> <div class="mc"> <div class="iloading">\u6b63\u5728\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...</div> </div> </div></div><div class="left"> <div id="recent-view-track" class="m m2"> <div class="mt"> <h2>\u6700\u8fd1\u6d4f\u89c8</h2> </div> <div class="mc"> <div class="iloading">\u6b63\u5728\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...</div> </div> </div> </div><span class="clr"></span>')}var f='<ul data-update="new">	{for list in history}    <li'+l+'>        <div class="p-img">            <a href="${list.productUrl}"><img src="${pageConfig.FN_GetImageDomain(list.wid)}n5/${list.imageUrl}" alt="${list.wname}" /></a>        </div>        <div class="p-name">            <a href="${list.productUrl}">${list.wname}</a>        </div>        <div class="p-price">            <img src="http://jprice.360buyimg.com/price/gp${list.wid}-1-1-1.png" onerror="this.src=\'http://misc.360buyimg.com/lib/skin/e/i/error-3.gif\'" />        </div>    </li>    {/for}	  <li class="all-recent" style="text-align:right;padding:5px 0;"><a href="http://my.'+pageConfig.FN_getDomain()+'/history/list.html" target="_blank" style="color:#005ea7;">\u5168\u90e8\u6d4f\u89c8\u5386\u53f2 <span style="font-family:simsun;">&gt;</span></a></li></ul>';var e='<span class="guess-control" id="guess-forward">&lt;</span><span class="guess-control" id="guess-backward">&gt;</span><div id="guess-scroll"><ul class="lh">{for list in guessyou}<li'+a+' id="g${list.wid}">	<div class="p-img">		<a target="_blank" title="${list.wname}" href="${list.productUrl}"><img height="130" width="130" alt="${list.wname}" src="${pageConfig.FN_GetImageDomain(list.wid)}n3/${list.imageUrl}"></a>	</div>	<div class="p-name">		<a target="_blank" title="${list.wname}" href="${list.productUrl}">${list.wname}</a>	</div>	<div class="p-comm">		<span class="star sa5"></span><br/>		<a target="_blank" href="http://club.360buy.com/review/${list.wid}-1-1.html">(\u5df2\u67090\u4eba\u8bc4\u4ef7)</a>	</div>	<div class="p-price">			<img src="http://jprice.360buyimg.com/price/gp${list.wid}-1-1-1.png" onerror="this.src=\'http://misc.360buyimg.com/lib/skin/e/i/error-3.gif\'" />	</div></li>{/for}</ul></div>';var j=d||f,k=b||e;if(g.history!==null&&g.history.length>0){$(this.sRecent).find(".mc").html(j.process(g));$(this.sRecent).find(".mt").append('<div class="extra"><a href="http://my.'+pageConfig.FN_getDomain()+'/history/list.html" target="_blank">\u66f4\u591a</a></div>');if(this.isBook){log("BOOK&HomeHis","Show")}else{clsPVAndShowLog("","",3,"s")}}else{$(this.sGuess).find("h2").html("\u672c\u5468\u70ed\u9500");$(this.sRecent).find(".mc").html('<div class="no-track"><h4>\u60a8\u8fd8\u672a\u5728\u4eac\u4e1c\u7559\u4e0b\u8db3\u8ff9</h4><p>\u5728\u60a8\u7684\u8d2d\u7269\u65c5\u7a0b\u4e2d\uff0c\u60a8\u53ef\u4ee5\u968f\u65f6\u901a\u8fc7\u8fd9\u91cc\u67e5\u770b\u60a8\u4e4b\u524d\u7684\u6d4f\u89c8\u8bb0\u5f55\uff0c\u4ee5\u4fbf\u5feb\u6377\u8fd4\u56de\u60a8\u66fe\u7ecf\u611f\u5174\u8da3\u7684\u9875\u9762\u3002</p></div>')}if(g.guessyou!==null&&g.guessyou.length>0){var c=[];$(this.sGuess).find(".mc").html(e.process(g));$(this.sGuess).find(".mt .extra").html('<a href="http://my.'+pageConfig.FN_getDomain()+'/personal/guess.html" target="_blank">\u66f4\u591a\u63a8\u8350</a>');var h=pageConfig.wideVersion&&!!pageConfig.compatible?5:4;$("#guess-scroll").imgScroll({visible:h,step:h,prev:"#guess-forward",next:"#guess-backward"});if(this.isBook){log("BOOK&HomeTrack","Show")}else{clsPVAndShowLog("","",2,"s")}var m=[];$("#guess-scroll ul li").each(function(){m.push($(this).attr("id"))});this.getCommentData(m.join(",").replace(/g/g,""))}else{$(this.sGuess).find(".mc").html('<div class="nothing">\u6682\u65e0\u63a8\u8350</div>')}}};(function(){var b=document.body.id=="book",a="";if(b){a="http://my."+pageConfig.FN_getDomain()+"/book/track.action?jsoncallback=?"}else{a="http://my."+pageConfig.FN_getDomain()+"/global/track.action?jsoncallback=?";clsPVAndShowLog("","",3,"p");clsPVAndShowLog("","",2,"p")}var c=new ProductTrack("#recent-view-track","#maybe-like",b).getData(a)})();
